<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Re:Anime ¬∑ Ver con Ram</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body{margin:0;background:#0b0b10;color:#fff;font-family:system-ui,sans-serif}
    .stage{display:grid;grid-template-columns:1fr 340px;height:100vh}
    .video-zone{display:flex;justify-content:center;align-items:center;background:#000}
    .video-wrapper{width:100%;max-width:1100px;aspect-ratio:16/9}
    iframe{width:100%;height:100%;border:none}

    .ram-zone{background:#141421;border-left:1px solid #222;display:flex;flex-direction:column;padding:1rem}
    .ram-head{display:flex;align-items:center;gap:.6rem;margin-bottom:.4rem}
    .ram-head img{width:56px;height:56px}
    .ram-name{color:#ff4ecd;font-weight:bold}
    .ram-sub{font-size:.75rem;color:#aaa}

    .ram-chat{flex:1;background:#0f0f18;border-radius:14px;padding:.6rem;overflow:auto;font-size:.85rem}
    .msg{margin-bottom:.35rem}
    .ram{color:#ffb6d9}
    .sys{color:#9aa0ff}

    .ram-controls{display:grid;grid-template-columns:1fr 1fr;gap:.4rem;margin-top:.6rem}
    .ram-controls button{background:#ff4ecd;color:#fff;border:none;border-radius:10px;padding:.4rem;font-size:.75rem;cursor:pointer}

    @media(max-width:900px){.stage{grid-template-columns:1fr}.ram-zone{height:48vh}}
  </style>
</head>
<body>

<div class="stage">
  <div class="video-zone"><div class="video-wrapper" id="video"></div></div>

  <div class="ram-zone">
    <div class="ram-head">
      <img src="Assets/ReAnime-Mascot.png" alt="Ram">
      <div>
        <div class="ram-name">Ram</div>
        <div class="ram-sub" id="ram-info">Cargando‚Ä¶</div>
      </div>
    </div>

    <div class="ram-chat" id="chat"></div>

    <div class="ram-controls">
      <button data-a="comment">üí¨ Comentar</button>
      <button data-a="fact">üìå Dato</button>
      <button data-a="opinion">üí≠ Opini√≥n</button>
      <button data-a="react">üòÆ Reacci√≥n</button>
      <button data-a="next">‚è≠ Siguiente</button>
      <button data-a="back">‚¨Ö Volver</button>
    </div>
  </div>
</div>

<script>
const chat = document.getElementById('chat');
const video = document.getElementById('video');
const info = document.getElementById('ram-info');
const params = new URLSearchParams(location.search);
const animeId = params.get('id');

let fakeTime = 0;
let currentAnime, currentEpisode, episodeIndex = 0;
let lastInteraction = Date.now();

const format = s => `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;

const say = (txt,type='ram') =>{
  const d=document.createElement('div');
  d.className='msg '+type;
  d.textContent = type==='ram' ? `Ram [${format(fakeTime)}]: ${txt}` : txt;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
};

const rand = a => a[Math.floor(Math.random()*a.length)];

fetch('animes.json').then(r=>r.json()).then(list=>{
  currentAnime = list.find(a=>a.id===animeId);
  if(!currentAnime){ say('No s√© qu√© anime es este‚Ä¶'); return; }

  const last = JSON.parse(localStorage.getItem('lastWatched')||'null');
  episodeIndex = last && last.id===currentAnime.id ? last.index : 0;
  currentEpisode = currentAnime.episodes[episodeIndex];

  info.textContent = `${currentAnime.name} ¬∑ Ep ${currentEpisode.number}`;
  say(`Bien‚Ä¶ ${currentAnime.name}, episodio ${currentEpisode.number}.`);

  const tmp=document.createElement('div');
  tmp.innerHTML=currentEpisode.embed;
  const iframe=tmp.querySelector('iframe');
  iframe.loading='lazy';
  video.appendChild(iframe);

  setInterval(()=>fakeTime++,1000);

  const timedComments = [
    {t:60, m:'Ya estamos entrando en calor.'},
    {t:300, m:'Aqu√≠ empieza el desarrollo.'},
    {t:600, m:'Este momento es clave.'},
    {t:900, m:'Presta atenci√≥n a los detalles.'}
  ];

  const generic = [
    'Hmm‚Ä¶ interesante.','Esto explica muchas cosas.','No esperaba eso.','Esto es muy humano.','Ram ya lo sospechaba.'
  ];

  const reactions = ['üòÆ','üòÑ','üòê','üò¥','üò≥','üò°'];

  let tcIndex = 0;

  setInterval(()=>{
    if(timedComments[tcIndex] && fakeTime >= timedComments[tcIndex].t){
      say(timedComments[tcIndex].m);
      tcIndex++;
    }

    if(Date.now()-lastInteraction>45000){
      say(rand(generic));
    }
  },5000);

  document.querySelectorAll('.ram-controls button').forEach(b=>{
    b.onclick=()=>{
      lastInteraction = Date.now();
      const a=b.dataset.a;
      if(a==='back') history.back();
      if(a==='fact') say(rand(currentAnime.dato||['No tengo un dato ahora.']));
      if(a==='opinion') say(rand(currentAnime.opinion||['Es interesante.']));
      if(a==='comment') say(rand(generic));
      if(a==='react') say(rand(reactions));
      if(a==='next'){
        if(currentAnime.episodes[episodeIndex+1]){
          localStorage.setItem('lastWatched',JSON.stringify({id:currentAnime.id,index:episodeIndex+1}));
          location.reload();
        }else{
          say('No hay m√°s episodios por ahora.');
        }
      }
    };
  });
});
</script>

</body>
</html>
