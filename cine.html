<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Re:Anime Â· Ver con Ram</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body{
      margin:0;
      background:#0b0b10;
      color:#fff;
      font-family:system-ui, sans-serif;
    }
    .stage{
      display:grid;
      grid-template-columns:1fr 320px;
      height:100vh;
    }
    .video-zone{
      display:flex;
      justify-content:center;
      align-items:center;
      background:#000;
    }
    .video-wrapper{
      width:100%;
      max-width:1100px;
      aspect-ratio:16/9;
    }
    iframe{width:100%;height:100%;border:none}

    .ram-zone{
      background:#141421;
      border-left:1px solid #222;
      display:flex;
      flex-direction:column;
      padding:1rem;
    }
    .ram-head{
      display:flex;
      align-items:center;
      gap:.6rem;
      margin-bottom:.6rem;
    }
    .ram-head img{width:56px;height:56px}
    .ram-name{color:#ff4ecd;font-weight:bold}

    .ram-chat{
      flex:1;
      background:#0f0f18;
      border-radius:14px;
      padding:.6rem;
      overflow:auto;
      font-size:.9rem;
    }
    .msg{margin-bottom:.4rem}
    .ram{color:#ffb6d9}

    .ram-controls{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:.4rem;
      margin-top:.6rem;
    }
    .ram-controls button{
      background:#ff4ecd;
      color:#fff;
      border:none;
      border-radius:10px;
      padding:.4rem;
      font-size:.8rem;
      cursor:pointer;
    }

    @media(max-width:900px){
      .stage{grid-template-columns:1fr}
      .ram-zone{height:45vh}
    }
  </style>
</head>
<body>

<div class="stage">
  <div class="video-zone">
    <div class="video-wrapper" id="video"></div>
  </div>

  <div class="ram-zone">
    <div class="ram-head">
      <img src="Assets/ReAnime-Mascot.png" alt="Ram">
      <div class="ram-name">Ram</div>
    </div>

    <div class="ram-chat" id="chat"></div>

    <div class="ram-controls">
      <button data-a="comment">ðŸ’¬ Comentar</button>
      <button data-a="fact">ðŸ“Œ Dato</button>
      <button data-a="opinion">ðŸ’­ OpiniÃ³n</button>
      <button data-a="back">â¬… Volver</button>
    </div>
  </div>
</div>

<script>
const chat = document.getElementById('chat');
const video = document.getElementById('video');
const params = new URLSearchParams(location.search);
const animeId = params.get('id');

const say = txt =>{
  const d=document.createElement('div');
  d.className='msg ram';
  d.textContent='Ram: '+txt;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
};

fetch('animes.json').then(r=>r.json()).then(list=>{
  const anime=list.find(a=>a.id===animeId);
  if(!anime){ say('Este anime no existe.'); return; }

  say(`Veamos ${anime.name} juntos.`);

  const last=JSON.parse(localStorage.getItem('lastWatched')||'null');
  const ep = last&&last.id===anime.id ? anime.episodes[last.index] : anime.episodes[0];

  const tmp=document.createElement('div');
  tmp.innerHTML=ep.embed;
  const iframe=tmp.querySelector('iframe');
  iframe.loading='lazy';
  video.appendChild(iframe);

  const random = arr => arr[Math.floor(Math.random()*arr.length)];

  const comments=[
    'Hmmâ€¦ esta parte me gusta.','Esto se va a poner interesante.','No apartes la vista.','He visto peores decisiones que esta.','Esto es muy humano.','Ram no harÃ­a eso.'
  ];

  let t=0;
  setInterval(()=>{
    if(t++%20===0) say(random(comments));
  },5000);

  document.querySelectorAll('.ram-controls button').forEach(b=>{
    b.onclick=()=>{
      const a=b.dataset.a;
      if(a==='back') history.back();
      if(a==='fact') say(random(anime.dato||['No tengo un dato ahora.']));
      if(a==='opinion') say(random(anime.opinion||['Es interesante.']));
      if(a==='comment') say(random(comments));
    };
  });
});
</script>

</body>
</html>